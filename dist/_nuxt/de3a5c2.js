(window.webpackJsonp=window.webpackJsonp||[]).push([[22],{409:function(e,t,r){"use strict";r.r(t);r(4),r(3),r(5),r(2),r(6);var n=r(41),o=r(9),l=r(0),d=(r(76),r(1),r(31),r(25)),c=r(60);function m(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(object);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,r)}return t}function f(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?m(Object(source),!0).forEach((function(t){Object(l.a)(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):m(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}var v={computed:f(f({},Object(d.d)([])),{},{disableModalItem:function(){return"View"===this.writeMode},validPassword:function(){return this.modalItem.password===this.modalItem.passwordConfirm}}),mixins:[c.a],data:function(){return{users:[],sites:[],modalItem:{sitePermissions:[]},addingItem:{sitePermissions:[]},isLoading:!1,writeMode:""}},mounted:function(){this.getUsers(),this.getSites()},methods:f(f({},Object(d.c)([])),{},{getSites:function(){var e=this;return Object(o.a)(regeneratorRuntime.mark((function t(){var r,n,data;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.$getSites();case 2:r=t.sent,n=r.status,data=r.data,200===n?e.sites=data:console.error("Response","Error");case 6:case"end":return t.stop()}}),t)})))()},getUsers:function(){var e=this;return Object(o.a)(regeneratorRuntime.mark((function t(){var r,n,data;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.$getUsers();case 2:r=t.sent,n=r.status,data=r.data,200===n?e.users=data:console.error("Response","Error");case 6:case"end":return t.stop()}}),t)})))()},deleteItem:function(e){var t=this;return Object(o.a)(regeneratorRuntime.mark((function r(){var n,o,l,d,c;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.$confirmDelete(t);case 2:if(!r.sent){r.next=19;break}return r.prev=4,r.next=7,t.$deleteUser(e);case 7:n=r.sent,o=n.status,n.data,200===o&&(t.$delete(t.users,t.users.findIndex((function(t){return t._id===e._id}))),t.$toAst(t,"Deleted Successfully","success")),r.next=19;break;case 13:r.prev=13,r.t0=r.catch(4),l=r.t0.message,d=r.t0.response,c=d?d.data:l,t.$toAst(t,c,"danger");case 19:case"end":return r.stop()}}),r,null,[[4,13]])})))()},remainSites:function(e,t,r){return e.filter((function(e){var o=e._id;return t.findIndex((function(e){var t=e.site;return t&&(Object(n.a)(t)===Object(n.a)({})?t._id:t)===o}))<0||o===(Object(n.a)(r)===Object(n.a)({})?r._id:r)}))},addSite:function(){this.modalItem.sitePermissions.push({site:this.remainSites(this.sites,this.modalItem.sitePermissions,0)[0]._id,userManagement:!1,hvacManagement:!1,tstatManagement:!1})},removeSite:function(e){this.$delete(this.modalItem.sitePermissions,this.modalItem.sitePermissions.findIndex((function(t){return t.site===e.site})))},showModal:function(){this.$refs["modal-crud-users"].show()},hideModal:function(){this.$refs["modal-crud-users"].hide()},addNewItem:function(){this.writeMode="Add",this.modalItem=this.addingItem,this.showModal()},editItem:function(e){this.writeMode="Edit",this.modalItem=e,this.showModal()},viewItem:function(e){this.writeMode="View",this.modalItem=e,this.showModal()},writeItem:function(e){var t=this;return Object(o.a)(regeneratorRuntime.mark((function r(){var n,o,data,l,d,c,m,f,v,h,w;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(e.preventDefault(),t.isLoading=!0,"Add"!==t.writeMode){r.next=18;break}return r.prev=3,r.next=6,t.$addUser(t.modalItem);case 6:n=r.sent,o=n.status,data=n.data,200===o?(t.users.push(data),t.addingItem={sitePermissions:[]},t.hideModal()):console.error("Error Add User"),r.next=18;break;case 12:r.prev=12,r.t0=r.catch(3),l=r.t0.message,d=r.t0.response,c=d?d.data:l,t.$toAst(t,c,"danger");case 18:if("Edit"!==t.writeMode){r.next=34;break}return r.prev=19,r.next=22,t.$editUser(t.modalItem);case 22:m=r.sent,f=m.status,m.data,200===f?(t.$set(t.users,t.users.findIndex((function(e){return e._id===t.modalItem._id})),t.$deepClone(t.modalItem)),t.hideModal()):console.error("Error Edit User"),r.next=34;break;case 28:r.prev=28,r.t1=r.catch(19),v=r.t1.message,h=r.t1.response,w=h?h.data:v,t.$toAst(t,w,"danger");case 34:t.isLoading=!1;case 35:case"end":return r.stop()}}),r,null,[[3,12],[19,28]])})))()}})},h=r(14),component=Object(h.a)(v,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("b-card",{staticClass:"mx-2 full-screen",attrs:{"no-body":""}},[r("b-row",{staticClass:"mx-0 bg-default"},[r("b-col",{staticClass:"text-left"},[r("h1",{staticClass:"h2"},[r("span",{staticClass:"specialty"},[e._v("Users")])])]),e._v(" "),r("b-col",{staticClass:"text-right"},[r("b-button",{attrs:{variant:"outline-primary",size:"sm"},on:{click:e.addNewItem}},[e._v("Add")])],1)],1),e._v(" "),r("b-table-simple",{staticClass:"h-100 mb-0 d-inline-block sticky-table",attrs:{bordered:"",hover:"",small:"",responsive:"","sticky-header":""}},[r("b-thead",[r("b-tr",[r("b-th",{staticClass:"text-nowrap"},[e._v("#")]),e._v(" "),r("b-th",{staticClass:"text-nowrap"},[e._v("Name")]),e._v(" "),r("b-th",{staticClass:"text-nowrap"},[e._v("Email")]),e._v(" "),r("b-th",{staticClass:"text-nowrap"},[e._v("System Admin")]),e._v(" "),r("b-th",{staticClass:"text-nowrap"},[e._v("Disabled")]),e._v(" "),r("b-th",{staticClass:"text-nowrap"},[e._v("Current Site")]),e._v(" "),r("b-th",{staticClass:"text-nowrap"},[e._v("Total Sites")]),e._v(" "),r("b-th",{staticClass:"text-nowrap"},[e._v("Action")])],1)],1),e._v(" "),e._l(e.users,(function(t,n){return r("b-tbody",{key:n},[r("b-tr",[r("b-td",{staticClass:"text-center"},[e._v(e._s(n+1))]),e._v(" "),r("b-td",[e._v(e._s(t.name))]),e._v(" "),r("b-td",[e._v(e._s(t.email))]),e._v(" "),r("b-td",{staticClass:"text-center"},[r("font-awesome-icon",{staticClass:"fai-checkbox",attrs:{icon:["fas",t.sysAdmin?"check-square":"square"]}})],1),e._v(" "),r("b-td",{staticClass:"text-center"},[r("font-awesome-icon",{staticClass:"fai-checkbox",attrs:{icon:["fas",t.disabled?"check-square":"square"]}})],1),e._v(" "),r("b-td",[e._v(e._s(t.currentSite?t.currentSite.name:""))]),e._v(" "),r("b-td",{staticClass:"text-center"},[e._v(e._s(t.sitePermissions?t.sitePermissions.length:""))]),e._v(" "),r("b-td",{staticClass:"text-center"},[r("b-button",{staticClass:"crud-action",attrs:{size:"sm",variant:"outline-primary"},on:{click:function(r){return e.viewItem(t)}}},[r("font-awesome-icon",{attrs:{icon:["fas","eye"]}})],1),e._v(" "),r("b-button",{staticClass:"crud-action",attrs:{size:"sm",variant:"outline-info"},on:{click:function(r){return e.editItem(t)}}},[r("font-awesome-icon",{attrs:{icon:["fas","pencil-alt"]}})],1),e._v(" "),r("b-button",{staticClass:"crud-action",attrs:{size:"sm",variant:"outline-danger"},on:{click:function(r){return e.deleteItem(t)}}},[r("font-awesome-icon",{attrs:{icon:["fas","trash-alt"]}})],1)],1)],1)],1)}))],2)],1),e._v(" "),r("b-modal",{ref:"modal-crud-users",attrs:{id:"modal-crud-users",size:"lg",title:e.writeMode,"hide-footer":""}},[r("b-row",[r("b-col",[r("b-overlay",{attrs:{show:e.isLoading,rounded:"sm"}},[r("b-form",{on:{submit:e.writeItem}},[r("b-form-group",{attrs:{id:"input-name-group",label:"Name:","label-for":"input-name"}},[r("b-form-input",{attrs:{id:"input-name",type:"text",placeholder:"Enter Name",required:"",autocomplete:"off",disabled:e.disableModalItem},model:{value:e.modalItem.name,callback:function(t){e.$set(e.modalItem,"name",t)},expression:"modalItem.name"}})],1),e._v(" "),r("b-row",[r("b-col",{attrs:{sm:"12",md:"6"}},[r("b-form-group",{attrs:{id:"input-email-group",label:"Email:","label-for":"input-email"}},[r("b-form-input",{attrs:{id:"input-email",type:"email",placeholder:"Enter Email",required:"",autocomplete:"off",disabled:e.disableModalItem},model:{value:e.modalItem.email,callback:function(t){e.$set(e.modalItem,"email",t)},expression:"modalItem.email"}})],1)],1),e._v(" "),r("b-col",{attrs:{sm:"12",md:"6"}},[r("b-form-group",{attrs:{id:"input-phone-group",label:"Phone:","label-for":"input-phone"}},[r("b-form-input",{attrs:{id:"input-phone",type:"tel",placeholder:"Enter Phone",required:"",autocomplete:"off",disabled:e.disableModalItem},model:{value:e.modalItem.phone,callback:function(t){e.$set(e.modalItem,"phone",t)},expression:"modalItem.phone"}})],1)],1)],1),e._v(" "),r("b-row",[r("b-col",{attrs:{sm:"12",md:"6"}},[r("b-form-group",{attrs:{id:"input-password-group",label:"Password:","label-for":"input-password"}},[r("b-form-input",{ref:"input-password",attrs:{id:"input-password",type:"password",placeholder:"Enter Password",required:"",autocomplete:"off",disabled:e.disableModalItem},model:{value:e.modalItem.password,callback:function(t){e.$set(e.modalItem,"password",t)},expression:"modalItem.password"}})],1)],1),e._v(" "),r("b-col",{attrs:{sm:"12",md:"6"}},[r("b-form-group",{ref:"input-password-confirm-group",attrs:{label:"Confirm Password:","label-for":"input-password-confirm"}},[r("b-form-input",{ref:"input-password-confirm",attrs:{id:"input-password-confirm",type:"password",placeholder:"Enter Confirm Password",required:"",autocomplete:"off",disabled:e.disableModalItem},model:{value:e.modalItem.passwordConfirm,callback:function(t){e.$set(e.modalItem,"passwordConfirm",t)},expression:"modalItem.passwordConfirm"}})],1)],1),e._v(" "),e.validPassword?e._e():r("b-col",[r("span",{staticClass:"text-danger"},[e._v("Password Does not match")])])],1),e._v(" "),r("b-row",[r("b-col",[r("b-form-checkbox",{attrs:{id:"input-system-admin",disabled:e.disableModalItem},model:{value:e.modalItem.sysAdmin,callback:function(t){e.$set(e.modalItem,"sysAdmin",t)},expression:"modalItem.sysAdmin"}},[e._v("  \n                    System Admin\n                  ")])],1),e._v(" "),r("b-col",[r("b-form-checkbox",{attrs:{id:"input-disable",disabled:e.disableModalItem},model:{value:e.modalItem.disabled,callback:function(t){e.$set(e.modalItem,"disabled",t)},expression:"modalItem.disabled"}},[e._v("  \n                    Disable\n                  ")])],1)],1),e._v(" "),r("b-row",{staticClass:"my-3"},[r("b-col",[r("span",[e._v("Site Permissions")]),e._v(" "),e.modalItem.sitePermissions.length<e.sites.length?r("b-button",{attrs:{size:"sm",variant:"link"},on:{click:function(t){return e.addSite()}}},[r("font-awesome-icon",{attrs:{icon:["fas","plus-circle"]}})],1):e._e()],1)],1),e._v(" "),e._l(e.modalItem.sitePermissions,(function(t,n){return r("b-row",{key:n,staticClass:"my-3"},[r("b-col",{attrs:{cols:"1"}},[r("b-button",{attrs:{size:"sm",variant:"link"},on:{click:function(r){return e.removeSite(t)}}},[r("font-awesome-icon",{staticStyle:{color:"red"},attrs:{icon:["fas","minus-circle"]}})],1)],1),e._v(" "),r("b-col",{attrs:{cols:"10",md:"7"}},[r("b-form-select",{attrs:{size:"sm",options:e.remainSites(e.sites,e.modalItem.sitePermissions,t.site),"value-field":"_id","text-field":"name"},scopedSlots:e._u([{key:"first",fn:function(){return[r("b-form-select-option",{attrs:{value:null,disabled:""}},[e._v("-- Please select an site --")])]},proxy:!0}],null,!0),model:{value:t.site,callback:function(r){e.$set(t,"site",r)},expression:"permission.site"}})],1),e._v(" "),r("b-col",{staticClass:"d-md-none",attrs:{cols:"1"}}),e._v(" "),r("b-col",{attrs:{cols:"3",md:"1"}},[r("b-form-checkbox",{attrs:{disabled:e.disableModalItem},model:{value:t.userManagement,callback:function(r){e.$set(t,"userManagement",r)},expression:"permission.userManagement"}},[e._v("  \n                    User\n                  ")])],1),e._v(" "),r("b-col",{attrs:{cols:"3",md:"1"}},[r("b-form-checkbox",{attrs:{disabled:e.disableModalItem},model:{value:t.hvacManagement,callback:function(r){e.$set(t,"hvacManagement",r)},expression:"permission.hvacManagement"}},[e._v("  \n                    Hvac\n                  ")])],1),e._v(" "),r("b-col",{attrs:{cols:"3",md:"1"}},[r("b-form-checkbox",{attrs:{disabled:e.disableModalItem},model:{value:t.tstatManagement,callback:function(r){e.$set(t,"tstatManagement",r)},expression:"permission.tstatManagement"}},[e._v("  \n                    Tstat\n                  ")])],1)],1)})),e._v(" "),r("b-row",[r("b-col",{staticClass:"text-right"},[r("b-button",{attrs:{type:"button",size:"sm",variant:"danger"},on:{click:e.hideModal}},[e._v("Cancel")]),e._v(" "),e.disableModalItem?e._e():r("b-button",{attrs:{type:"submit",size:"sm",variant:"primary",disabled:!e.validPassword}},[e._v("Save")])],1)],1)],2)],1)],1)],1)],1)],1)}),[],!1,null,null,null);t.default=component.exports}}]);